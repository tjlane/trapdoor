#!/usr/bin/env python

# runs 30 & 47 are known to contain ice :)

import sys
sys.path.append('/reg/neh/home2/tjlane/opt/trapdoor')

import numpy as np

from trapdoor import guardian
from trapdoor import core

cons_thresh = 5
area_thresh = 10000

# use trapdoor.guardian but inject a new source
camera_buffer = np.zeros((32, 185, 388), dtype=np.int32)
cntrl = guardian.ShutterControl(cons_thresh, area_thresh, debug_mode=True)

monitor = core.MapReducer(guardian.binarize, guardian.accumulate_damage, cntrl,
                          result_buffer=camera_buffer,
                          source='cxishmem')
monitor.start(verbose=False)




